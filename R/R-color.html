<!Doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>R 教程 | 生物慕课网</title>

<link rel="canonical" href="http://www.biomooc.com/R/R-tutorial.html" />
<meta name="keywords" content="R 绘图教程,R低水平绘图命令">
<meta name="description" content="R 绘图教程,R低水平绘图命令。">
		
	<link rel="shortcut icon" href="/img/favicon.ico" mce_href="/img/favicon.ico" type="image/x-icon" >
	<link rel="stylesheet" href="/wp-content/themes/biomooc/style.css?v=1.141" type="text/css" media="all" />	
	<link rel="stylesheet" href="/static/css/font-awesome.min.css" media="all" />	
<!--
	<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" media="all" />	  
-->
  <!--[if gte IE 9]><!-->
  <script src="/static/js/jquery.min.js"></script>
  <!--<![endif]-->
  <!--[if lt IE 9]>
     <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
     <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
  <![endif]-->
  <link rel="apple-touch-icon" href="/img/mobile-icon.png"/>
  <meta name="apple-mobile-web-app-title" content="生物慕课网">

</head>

<style>
/*本页R代码过长: 最长n px,超过了出现滚动条*/
.maxHeight{max-height:400px; overflow:scroll;}
</style>

<body>
<!-- 头尾自动加载 -->
<script>
$(function(){
	$.get('/part/header-nav.html',function(data,status){
		$('body').prepend(data);//header-nav
	});
	
	$('<div id="footer" class="mar-t50"></div>').appendTo($("body"));
	$("#footer").load("/part/footer.html"); //footer
	
	$.get('/part/right-bottom-btn.html',function(data,status){
		$('#footer').after(data);//右下角按钮
	});

	
			
	//左右菜单
	$.get('./part/menu-left.html',function(data,status){
		$('.main .row').first().prepend(data);//左侧菜单-本文件夹内使用
	});
	
	$.get('/part/menu-right.html',function(data,status){
		$('.main .row').first().append(data);//右侧菜单-全局通用
		//没有事件，还需要绑定事件
		
		
	});
	
	$.getScript("/wp-content/themes/biomooc/assets/js/main.js?v=1.15");//回到顶部js文件
});
</script>


	
	

<!--  内容  -->
<div class="container main">
	<!-- 中间 -->
	<div class="row">
	





<div class="col middle-column">
		
	
	<div class="article">
			<div class="article-heading-ad" style="display: none;">
		
		</div>
		<div class="previous-next-links">
			<div class="previous-design-link"><i style="font-size:16px;" class="fa fa-arrow-left" aria-hidden="true"></i> <a href="/R/R-intro.html" rel="pre">R 简介</a> </div>
			<div class="next-design-link"><a href="/R/R-intro.html" rel="next"> R 简介</a> <i style="font-size:16px;" class="fa fa-arrow-right" aria-hidden="true"></i></div>
		</div>
		<div class="article-body">
		
			<div class="article-intro" id="content">
			
			<h1><span class="color_h1">R 色彩 </span> 详解与实例</h1>



<h2 class="tutheader">目录</h2>
<p><b>要点</b>: R中的色彩很丰富，灵活运用才能提高图片的美感和区分度。本文前面是实例，后面是R中怎么做。</p>

<ul>
	<li><a href="#1">figure中的色彩实例</a>
		<ul>
			<li><a href="#1_1">色彩列表:微软的4种颜色</a>
			<li><a href="#1_2">示意图色彩</a>
			<li><a href="#1_3">条形图色彩</a>
		</ul>
	</li>
	<li><a href="#2">R 中的色彩函数</a>
		<ul>
			<li><a href="#2_1">内置渐变色</a>
			<li><a href="#2_2">预置配色与自定义渐变色</a>
			<li><a href="#2_3">伪时间热图的渐变色设置原理</a>
		</ul>
	</li>
	<li><a href="#3">ggplot2中的色彩函数</a></li>

</ul>







<a name='1'></a>
<h2 class="tutheader">figure中的色彩实例</h2>
<p>简书笔记: 
	<a target="_blank" href="https://www.jianshu.com/p/8b0e34364b89">论文figure色彩实例 - 权衡美观与区分度</a> | 
	[推荐]<a target="_blank" href="https://www.jianshu.com/p/4e6fb1269ece">R语言中的渐变色</a> | 
	<a target="_blank" href="https://mp.weixin.qq.com/s?__biz=MzI5MTcwNjA4NQ==&mid=2247485182&idx=1&sn=7b5c1d800560eddcf898ed410720a2a3&scene=21#wechat_redirect">史上最全的图表色彩运用原理</a>
</p>





<a name='1_1'></a>
<h3>色彩列表</h3>
<p>微软的四种颜色</p>
<style>
ul.color,
ul.color li{margin:0; padding:0; list-style-type: none;}
</style>
<ul class=color>
	<li>
		<span style="display:inline-block; background:#F54D22; height:40px; width:40px;"></span>
		<span style="display:inline-block; background:#83BA00; height:40px; width:40px;"></span>
	</li>
	<li>
		<span style="display:inline-block; background:#00A5F0; height:40px; width:40px;"></span>
		<span style="display:inline-block; background:#FFBA00; height:40px; width:40px;"></span>
	</li>
</ul>
<br>
<br>





<a name='1_2'></a>
<p>示意图色彩</p>


10x单细胞示意图<br>
<img src="images/color/color_002.png" /><br>


<br>
<br>




<a name='1_3'></a>
<p>条形图色彩</p>

条形图<br>
<img src="images/color/color_001.png" /><br>


<br>
<br>













<a name='2'></a>
<h2 class="tutheader">R 中的色彩函数</h2>
<p>如何使用R语言画出漂亮的图，颜色很重要，既要协调，又要有一定的分辨力。</p>
R原生的颜色请参考本站 <a href="R-draw-basic.html#22">R 颜色</a>。


<a name='2_1'></a>
<h3 class="tutheader">1. R 内置渐变色</h3>
<p><b>彩虹色</b></p>
<div class="code notranslate">
	<div style="white-space: pre-wrap;">#可以拿到任意多个颜色，当然颜色越多，分辨力越低。
barplot(rep(1,8), col=rainbow(8),border=NA, axes=F)
rainbow(8)
# [1] "#FF0000FF" "#FFBF00FF" "#80FF00FF" "#00FF40FF" "#00FFFFFF" "#0040FFFF"
# [7] "#8000FFFF" "#FF00BFFF"

barplot(rep(1,20), col=rainbow(20),border=NA, axes=F) #分辨力降低</div>
</div>
<br>


<p><b>其他几个预置渐变色</b></p>
<img src="images/color/color_a1.png" /><br>
<div class="code notranslate">
	<div style="white-space: pre-wrap;">par(mfrow=c(5,1), mar=c(0,0,2,0))
n=10

barplot(rep(1,n), col= rainbow(n), border=NA,axes=F, main="rainbow") #彩虹色

#heat.colors()从红色渐变到黄色，再变到白色
barplot(rep(1,n), col= heat.colors(n), border=NA,axes=F, main="heat.colors") 

#terrain.colors() 从绿色渐变到黄色，再到棕色，最后到白色 
barplot(rep(1,n),col=terrain.colors(n), border=NA,axes=F, main="terrain.colors")

#topo.colors() 从蓝色渐变到青色，再到黄色，最后到棕色 
barplot(rep(1,n),col=topo.colors(n), border=NA,axes=F, main="topo.colors")

#cm.colors() 从青色渐变到白色，再到粉红色
barplot(rep(1,n),col=cm.colors(n), border=NA,axes=F, main="cm.colors")</div>
</div>
<br>




<a name='2_2'></a>
<h3 class="tutheader">2. 预置配色与自定义渐变色</h3>
<p>使用预置配色集合 Set2/Dark2，通过函数colorRampPalette()插值生成任意个渐变颜色。</p>
<img src="images/color/color_a2.png" /><br>

<div class="code notranslate">
	<div style="white-space: pre-wrap;">library(RColorBrewer)
display.brewer.all() #显示全部颜色集合

## 选一个颜色集合，比如Dark2, Set2
csn='Dark2'
myColors=brewer.pal(8,csn) #该主题有n种颜色

par( mfrow=c(3,1), mar=c(0,1,1,0)) #bottom, left, top, right
barplot(rep(1,8),col= myColors, main=csn, axes=F,border=F)
# 插值，生成15个颜色
n=15
colorN=colorRampPalette(colors = myColors, interpolate ="linear")( n )
barplot(rep(1, n ),col= colorN, axes=F, border=F,
        main="linear") #插值方式
colorN2=colorRampPalette(colors = myColors, interpolate ="spline")( n )
barplot(rep(1, n ),col= colorN2, axes=F, border=F,
        main="spline") #插值方式</div>
</div>
<br>




<a name='2_3'></a>
<h3 class="tutheader">伪时间热图的渐变色设置原理</h3>
<p> monocle 的pseudotime_heatmap的配色很显眼，十分值得借鉴。 本文只关心渐变色生成部分。</p> 
<p> 整个图的画法请参考: <a target="_blank" href='https://tool.biomooc.com/R_scripts/#t9'>伪时间平滑化热图 plot_pseudotime_heatmap (仿monocle)</a> </p>
<img src="images/color/color_a3.png" /><br>


<div class="code notranslate maxHeight">
	<div style="white-space: pre-wrap;">############### color bar from monocle::plot_pseudotime_heatmap ##############
# 这个 color bar 来自于monocle，画热图效果很好
height = 1
n=22; mid=0.75;sill=0.25;base=1

table.ramp = function (n, mid = 0.5, sill = 0.5, base = 1, height = 1) {
  
  x <- seq(0, 1, length.out = n) #0-1之间取n个值
  y <- rep(0, length(x)) #等长度的0
  
  ### 定义极值 still
  sill.min <- max( c(1, round( (n-1)*(mid-sill/2) ) + 1) ) #14
  sill.max <- min( c(n, round( (n-1)*(mid+sill/2) ) + 1) ) #19
  
  ########## 替换0 平台期: 围绕mid的sill极值范围内的y取1
  y[sill.min:sill.max] <- 1
  y
  
  ### 定义 极值 base , 范围更宽
  base.min <- round( (n-1)*(mid-base/2) ) + 1 #6
  base.max <- round( (n-1)*(mid+base/2) ) + 1 #27
  
  ########## 替换1 上升部分
  # xi是 still到base的min过渡态, yi则是等长的0-1之间的间距值
  xi <- base.min:sill.min #[1]  6  7  8  9 10 11 12 13 14
  yi <- seq(0, 1, length.out = length(xi))
  # [1] 0.000 0.125 0.250 0.375 0.500 0.625 0.750 0.875 1.000
  
  # 获取xi中大于0小于等于n的元素的下标
  i <- which(xi > 0 & xi <= n) #[1] 1 2 3 4 5 6 7 8 9
  y[xi[i]] <- yi[i] #让y在这些位置上[6,14]，值等于yi
  y
  
  
  ########## 替换2 下降部分
  # xi是 still到base的max过渡态, yi则是等长的1-0之间的间距值
  xi <- sill.max:base.max # [1] 19 20 21 22 23 24 25 26 27
  yi <- seq(1, 0, length.out = length(xi))
  #[1] 1.000 0.875 0.750 0.625 0.500 0.375 0.250 0.125 0.000
  
  i <- which(xi > 0 & xi <= n) #[1] 1 2 3 4
  y[xi[i]] <- yi[i]
  y
  
  height * y
# [1] 0.000 0.000 0.000 0.000 0.000 0.000 0.125 0.250 0.375 0.500 0.625 0.750 0.875
#  [14] 1.000 1.000 1.000 1.000 1.000 1.000 0.875 0.750 0.625
}


height=1
n=10
#do.call("table.ramp", as.list(c(n, c(0.8, 0.2, 1)))) #等价于
rr=table.ramp(n, 0.8,0.2,1); rr
#[1] 0.0000000 0.0000000 0.0000000 0.0000000 0.3333333 0.6666667 1.0000000
#[8] 1.0000000 1.0000000 0.7500000
gg=table.ramp(n, 0.5,0.4,1); gg
#[1] 0.0000000 0.3333333 0.6666667 1.0000000 1.0000000 1.0000000 1.0000000
#[8] 0.6666667 0.3333333 0.0000000
bb=table.ramp(n, 0.2,0.2,1); bb
#[1] 0.7500000 1.0000000 1.0000000 1.0000000 0.6666667 0.3333333 0.0000000
#[8] 0.0000000 0.0000000 0.0000000

par(mfrow=c(2,1), mar=c(2,2,0,1)) #b,l,t,r
plot(rr, xlim=c(0.5,n+0.5), ylim=c(0,1), type='o', col='red', xaxt='n')
axis(1, at=seq(1, n), labels=seq(1,n)/10, las=2,cex.axis=0.7)
lines(gg, col='green', type='o')
lines(bb, col='blue', type='o')
#
hmcols=rgb(rr, gg, bb)
hmcols
#[1] "#0000BF" "#0055FF" "#00AAFF" "#00FFFF" "#55FFAA" "#AAFF55" "#FFFF00"
#[8] "#FFAA00" "#FF5500" "#BF0000"
#color.rs=rainbow(60)

posX=barplot(rep(1,length(hmcols)), col=hmcols, border = NA, space=0.1)
text(posX, -0.05, labels=hmcols,
     #col=hmcols,
     xpd=TRUE, #允许绘制在绘图区外
     cex=0.6, #字体是默认的倍数
     adj=1, #adj=1右上对齐
     srt=40) #倾斜30度)</div>
</div>
<br>
<br>











<a name='3'></a>
<h2 class="tutheader">ggplot2 中的色彩函数</h2>
coding ...

















			</div>
		</div>
		
		<div class="previous-next-links">
			<div class="previous-design-link"><i style="font-size:16px;" class="fa fa-arrow-left" aria-hidden="true"></i> <a href="/R/R-intro.html" rel="pre">R 简介</a> </div>
			<div class="next-design-link"><a href="/R/R-intro.html" rel="next"> R 简介</a> <i style="font-size:16px;" class="fa fa-arrow-right" aria-hidden="true"></i></div>
		</div>
	</div>
</div>







	
	
	
	
	










</div>

</div>

</body>
</html>