<!Doctype html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>R 教程 | 生物慕课网</title>

<link rel="canonical" href="http://www.biomooc.com/R/R-tutorial.html" />
<meta name="keywords" content="R 教程,R">
<meta name="description" content="R  教程。 本教程，我们将为大家介绍如何使用R。 R其实很容易学，相信你们能很快学会。 现在开始学习 R ！    谁适合阅读？ 本教程针对的是R数据分析人员阅读。">
		
	<link rel="shortcut icon" href="/img/favicon.ico" mce_href="/img/favicon.ico" type="image/x-icon" >
	<link rel="stylesheet" href="/wp-content/themes/biomooc/style.css?v=1.141" type="text/css" media="all" />	
	<link rel="stylesheet" href="/static/css/font-awesome.min.css" media="all" />	
  <!--[if gte IE 9]><!-->
  <script src="/static/js/jquery.min.js"></script>
  <!--<![endif]-->
  <!--[if lt IE 9]>
     <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
     <script src="//cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
  <![endif]-->
  <link rel="apple-touch-icon" href="/img/mobile-icon.png"/>
  <meta name="apple-mobile-web-app-title" content="生物慕课网">
<style>
p{text-indent:2em;}

/*本页R代码过长: 最长n px,超过了出现滚动条*/
.notranslate{max-height:400px; overflow-y:scroll;}
</style>
</head>


<body>
<!-- 头尾自动加载 -->
<script>
$(function(){
	$.get('/part/header-nav.html',function(data,status){
		$('body').prepend(data);//header-nav
	});
	
	$('<div id="footer" class="mar-t50"></div>').appendTo($("body"));
	$("#footer").load("/part/footer.html"); //footer
	
	$.get('/part/right-bottom-btn.html',function(data,status){
		$('#footer').after(data);//右下角按钮
	});

	
			
	//左右菜单
	$.get('./part/menu-left.html',function(data,status){
		$('.main .row').first().prepend(data);//左侧菜单-本文件夹内使用
	});
	
	$.get('/part/menu-right.html',function(data,status){
		$('.main .row').first().append(data);//右侧菜单-全局通用
		//没有事件，还需要绑定事件
		
		
	});
	
	$.getScript("/wp-content/themes/biomooc/assets/js/main.js?v=1.15");//回到顶部js文件
});
</script>


	
	

<!--  内容  -->
<div class="container main">
	<!-- 中间 -->
	<div class="row">
	





<div class="col middle-column">
		
	
	<div class="article">
			<div class="article-heading-ad" style="display: none;">
		
		</div>
		<div class="previous-next-links">
			<div class="previous-design-link"> </div>
			<div class="next-design-link"><a href="/R/R-intro.html" rel="next"> R 简介</a> <i style="font-size:16px;" class="fa fa-arrow-right" aria-hidden="true"></i></div>
		</div>
		<div class="article-body">
		
			<div class="article-intro" id="content">
			
			<h1><span class="color_h1">R </span> 面向对象编程(OOP)</h1>
			



<h2 class="tutheader">目录</h2>
<p><b>要点</b>: OOP是一门计算机语言成熟的标志。[R In Action, 2nd, Chapter20]</p>


<ul>
	<li><a href="#1">面向对象概述</a></li>
	<li><a href="#2">S3</a>
		<ul>
			<li><a href="#2_1">泛型函数</a></li>
			<li><a href="#2_2">S3泛型函数和方法: UseMethod</a></li>
			<li><a href="#2_3">NextMethod 函数</a></li>
		</ul>
	</li>
	<li><a href="#3">S4</a>
		<ul>
			<li><a href="#3_1">S4实例</a></li>
		</ul>
	</li>
	<li><a href="#4">Reference classes(RC)</a></li>
	<li><a href="#5">R6</a></li>
	<li><a href="#100">参考资料</a></li>
</ul>








<a name="1"></a>
<h2 class="tutheader">面向对象概述</h2>

<p>面向对象编程（Object Oriented Programming，OOP）是一种计算机编程架构。OOP 的一条基本原则是计算机程序是由单个能够起到子程序作用的单元或对象组合而成。</p>
<p>面向对象编程大大提高了代码编写的效率，防止代码一盘散沙而只能小打小闹，严格的OOP有助于构建大工程，有利于团队合作和社区分享。可以说OOP的使用程度标志着一门语言的成熟和值钱程度。
广泛使用的Java和JavaScript都是这样一路走向OOP的怀抱的。</p>
<p>R base 本身提供了3种类，S3, S4和Reference Classes, or RC，另一种和RC类似的R6类是以R6包提供的。ggplot2的作者hadley认为S3最重要，其次是R6，然后是S4。也有很多人认为S4最重要，其次是RC，而S3应该被避免。这就意味着R的社区使用着不同的系统。</p>
<p>S3和S4使用泛型，和现今最流行的语言(比如Java和JS)的OOP概念差异相当大。虽然总体概念类似，但是细节理念差很多，并不能即刻实现现有OOP技能到R的转变。</p>











<a name="2"></a>
<h2 class="tutheader">S3</h2>


<a name="2_1"></a>
<h3 class="tutheader">泛型函数</h3>

<p>R的print()函数很强大，能输出数字、字符、list、文本框等，你可能会想里面是不是很多if else 判断呢？如果是，那么只有原始作者能定义打印的类型，其他用户怎么添加新的打印类型呢？实际上这是通过S3泛型函数实现的。</p>

<div class="code notranslate">
	<div style="white-space: pre-wrap;"># 不同的类有不同的print方法，查看print所有泛型方法
> methods(print)
  [1] print.acf*                                          
  [2] print.AES*                                          
  [3] print.agnes*                                        
  [4] print.all_vars*                                     
  [5] print.anova*   
  ...
  [274] print.xngettext*                                    
  [275] print.xtabs*                                        
  see '?methods' for accessing help and source code
#


# 没想到，+号, [号 也是泛型函数
> getGeneric('+')
standardGeneric for "+" defined from package "base"
  belonging to group(s): Arith 

function (e1, e2) 
standardGeneric("+", .Primitive("+"))
<bytecode: 0x000000000b42a7e0>
<environment: 0x000000000b428e10>
Methods may be defined for arguments: e1, e2
Use  showMethods("+")  for currently available ones.</div>
</div>



<p>S3类仅仅是一个class属性，没有严格的检查，很松散。适用于日常代码较少时个人使用。有3个常用的函数：</p>
<p>is.object(xx) 查看xx是否是一个类的对象。</p>
<p>getS3method('fnName','className') 查看className对应的fnName的S3泛型方法。</p>
<p>getAnywhere('print.teacher')  查看函数的定义位置。</p>
<div class="code notranslate">
	<div style="white-space: pre-wrap;">> a='d'
> is.object(a) #没有class属性，还不是S3类
[1] FALSE
> class(a)='teacher' #添加class属性
> is.object(a) #有class属性了，就是S3类了
[1] TRUE

> attributes(a)
$class
[1] "teacher"
> a
[1] "d"
attr(,"class")
[1] "teacher"  #没错，a已经是一个teacher类了，太随意了！！


# 为teacher类定义一个print方法，就是在print后加点，再加上类名
> print.teacher=function(x){ print(paste('S3 class teacher:', x))}

> print(a) #由于a是teacher类，所以自动调用其泛型方法
[1] "S3 class teacher: d"


# 查找teacher类对应的print方法
> getS3method('print','teacher')
function(x){ print(paste('S3 class teacher:', x))}

# 查找在哪里定义的？
> getAnywhere('print.teacher')
A single object matching ‘print.teacher’ was found
It was found in the following places
  .GlobalEnv
  registered S3 method for print
with value

function(x){ print(paste('S3 class teacher:', x))}</div>
</div>





<a name="2_2"></a>
<h3 class="tutheader">S3泛型函数和方法: UseMethod </h3>
<p>“方法”在R里面就是指函数，S3中OOP“方法”是通过泛型函数（generic function）实现的。概念很抽象，但实现方式很简单，先看一个小例子。<p>
<div class="code notranslate">
	<div style="white-space: pre-wrap;">## 第一步：定义一个泛型函数，这个函数的函数体只有一个固定的语句
doit = function(...) UseMethod("doit")

## 第二步：设置针对特定CLASS的动作函数
doit.character = function(...) {
    cat("With STRING class attribute\n")
}
doit.integer = function(...) {
    cat("With INTEGER class attribute\n")
}
doit.God = function(...) {
    cat("With God class attribute\n")
}
### 第三步：设置一个默认的动作函数
doit.default = function(...) {
    cat("UNKNOWN class attribute\n")
}


##上面三个步骤就完成了doit泛型函数的设置。看看效果吧：
a = "ABCDE"

doit(a)
## With STRING class attribute

attr(a, "class") = "integer"
class(a) #[1] "integer"
doit(a)
## With INTEGER class attribute

attr(a, "class") = "God"
doit(a)
## With God class attribute

a = as.factor(a)
doit(a)
## UNKNOWN class attribute</div>
</div>


<p><b>注意几点：</b></p>
<p>  - 在函数定义部分定义了5个函数，doit函数为“泛型函数”，其他函数为“方法”</p>
<p>  - 泛型函数有一个关键的语句：调用UseMethod函数</p>
<p>  - 除泛型函数外其他函数名称的前缀（如果可以这么叫的话）都是和泛型函数相同，名称的后缀为CLASS名或default，用点号相连</p>
<p>  - 使用的时候可以只使用不带点号的doit函数，泛型函数根据其参数的class属性选择合适的“方法”函数</p>
<br>

<hr>
<p>这里面还有一个问题：针对特定类型的动作函数并没有用于识别数据类型的代码，函数调用的形式都是一样的，doit函数怎么知道该执行那个操作？关键就在于UseMethod这个函数。这个函数只能在函数体内使用，它可以有两个参数：</p>
<p><b>UseMethod(generic, object)</b></p>
<p>generic 是泛型函数的名称（字符串）， object 是用于确定动作函数的对象，如果缺省将使用泛型函数的第一个参数，UseMethod取其CLASS属性。如果要用其他参数进行类型判断，只需修改泛型函数。下面修改后的泛型函数使用第二个参数进行动作函数选择：
</p>

<div class="code notranslate">
	<div style="white-space: pre-wrap;">doit("abc", 1:10)
## With STRING class attribute

doit(1:10, "abc")
## With INTEGER class attribute

doit = function(...) {
    xx = list(...)
    UseMethod("doit", xx[[2]])
}
# 注意下面结果与修改泛型函数前的差别
doit(1:10, "abc")
## With STRING class attribute</div>
</div>


<p>generic 参数只说是泛型函数的名称，但没有限制必需和UseMethod调用者的函数名称相同。summary是R定义的最常用泛型函数之一，下面代码中的doit函数把summary函数的全部用法都偷过来了。如果你老记不住summary这个名称的写法，不妨试试这种用法：</p>

<div class="code notranslate">
	<div style="white-space: pre-wrap;">> doit = function(...) UseMethod("summary")
> doit(1:10)
#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#   1.00    3.25    5.50    5.50    7.75   10.00

> doit(airquality)
# airquality是R基本安装包datasets下的一组数据。</div>
</div>













<a name="2_3"></a>
<h3 class="tutheader">NextMethod 函数</h3>
<p>这是一个非常特殊的函数。《R Language Definition》中的说法是这样的： Methods invoked as a result of a call to NextMethod behave as if they had been invoked from the previous method.</p>
<p>太高深了，一头雾水。还是用代码来看看：</p>


<div class="code notranslate">
	<div style="white-space: pre-wrap;">doit = function(...) UseMethod("doit")
doit.character = function(...) {
    cat("With STRING class attribute\n")
    NextMethod()
}

doit.integer = function(...) {
    cat("With INTEGER class attribute\n")
    NextMethod()
}

doit.God = function(...) {
    cat("With God class attribute\n")
    NextMethod()
}

doit.default = function(...) {
    cat("UNKNOWN class attribute\n")
}

## 多CLASS属性对象
x = "abc"
class(x) = c("UNKNOWN", "integer", "character", "God")
doit(x)
# With INTEGER class attribute
# With STRING class attribute
# With God class attribute
# UNKNOWN class attribute</div>
</div>



<p>原来如此。如果在方法中都加入NextMethod函数，泛型函数会按照CLASS属性对所有方法都应用一遍。</p>
<p>但奇怪的是：x变量的CLASS属性第一个是位置类型UNKNOWN，doit泛型函数首先会使用它，但default方法中并没有使用NextMethod函数，运行完doit.default函数应该结束了，为什么有那么多输出呢？这就是《R Language Definition》天书中说的 as if 的意思：含有NextMethod函数的方法“似乎”都被幽灵一样的“前一种方法”调用了！</p>
<p>但这还不是全部。如果每种方法都使用NextMethod函数，程序运行将进入循环，对class属性向量的循环。这也不是简单的循环，是嵌套的：</p>


<div class="code notranslate">
	<div style="white-space: pre-wrap;">doit = function(...) UseMethod("doit")
doit.a1 = function(...) {
    cat("Loop 1 begin\n")
    NextMethod()
    cat("Loop 1 end\n")
}
doit.a2 = function(...) {
    cat("Loop 2 begin\n")
    NextMethod()
    cat("Loop 2 end\n")
}
doit.default = function(...) {
    cat("DEFAULT method goes here ...\n")
}
class(x) = c("unknown", "a1", "a2")
doit(x)
# Loop 1 begin
# Loop 2 begin
# DEFAULT method goes here ...
# Loop 2 end
# Loop 1 end

class(x) = c("a1", "unknown", "a2")
doit(x)
# Loop 1 begin
# Loop 2 begin
# DEFAULT method goes here ...
# Loop 2 end
# Loop 1 end

class(x) = c("unknown", "a2", "a1")
doit(x)
# Loop 2 begin
# Loop 1 begin
# DEFAULT method goes here ...
# Loop 1 end
# Loop 2 end

class(x) = c("a1", "a2", "unknown1", "unknown2")
doit(x)
# Loop 1 begin
# Loop 2 begin
# DEFAULT method goes here ...
# Loop 2 end
# Loop 1 end</div>
</div>


<p>从上面代码的运行结果可以看出：</p>
<p> - 循环最外层从CLASS属性向量第一个“已知”类属性开始，依次嵌套</p>
<p> - default方法在循环最内层，而且不管有几个“未知”类属性，它只执行一次</p>
<p> - 循环层次和“未知”类属性的位置无关</p>

<p>隐含的意思还包括：如果你在default方法中放入NextMethod函数，程序将进入死循环（还好R有预防措施）。其他更深层次的用法自己揣摩。</p>
<br>
<p>推荐用R包 sloop包的otype()函数查看类的来源，是 base, S3还是S4。</p>
























<a name="3"></a>
<h2 class="tutheader">S4</h2>


<p>S4 提供了基本的定义helper模板，比S3正式、严谨很多。S4定义在R base的methods包中，交互式环境一般都加载过了，但是批处理模式(如 Rscript)不一定，最好手动添加 library(methods)</p>

<p>记住2点：没有一个能回答所有疑问的S4参照标准，R的内部文档偶尔和社区最佳实践矛盾！当使用高级用法时，要仔细阅读文档，还要常搜索、常实验。</p>
<p>Bioconductor 社区是S4的长期用户，对S4的高效利用很有研究，比如 <a href="https://bioconductor.org/help/course-materials/2017/Zurich/S4-classes-and-methods.html">S4 classes and
methods</a> taught by Martin Morgan and Hervé Pagès, 或者查看新版本 <a href="https://bioconductor.org/help/course-materials/">Bioconductor course materials</a>. Martin Morgan 是R-core成员，也是Bioconductor项目领导，是世界上S4领域的应用专家。建议仔细阅读他回答过的问题 <a href="http://stackoverflow.com/search?tab=votes&amp;q=user%3a547331%20%5bs4%5d%20is%3aanswe">stackoverflow</a>。</p>
<p>xx</p>
<p>xx</p>


<div class="code notranslate">
	<div style="white-space: pre-wrap;">x

</div>
</div>













<a name="4"></a>
<h2 class="tutheader">Reference classes(RC)</h2>

<p>Reference classes in R are similar to object-oriented classes in other programming languages. They have all the features of S4 classes with an added environment. To create a reference class, we use the setRefClass() function. The methods in a reference class belong to the class itself.</p>

<p>xx</p>
<p>xx</p>












<a name="5"></a>
<h2 class="tutheader">R6</h2>
<p>R6包：<a href="https://cran.r-project.org/web/packages/R6/index.html">R6: Encapsulated Classes with Reference Semantics</a></p>












<a name="100"></a>
<h2 class="tutheader">参考资料</h2>

<pre>
1.Object Oriented Programming (OOP) in R | Create R Objects & Classes
https://data-flair.training/blogs/object-oriented-programming-in-r/


2.Object Oriented Programming (OOP) in R with S3, S4, and RC
https://techvidvan.com/tutorials/r-object-oriented-programming/


3.【推荐: 本文第一信息源】object-oriented programming (OOP). 
https://adv-r.hadley.nz/oo.html
https://adv-r.hadley.nz/s4.html


4.Object-Oriented Programming with S3 and R6 in R
https://www.datacamp.com/courses/object-oriented-programming-in-r-s3-and-r6


</pre>














			
			
			</div>
		</div>
		
		<div class="previous-next-links">
			<div class="previous-design-link"> </div>
			<div class="next-design-link"><a href="/R/R-intro.html" rel="next"> R 简介</a> <i style="font-size:16px;" class="fa fa-arrow-right" aria-hidden="true"></i></div>
		</div>
	</div>
</div>







	
	
	
	
	










</div>

</div>

</body>
</html>